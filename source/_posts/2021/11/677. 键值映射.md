---
title: 677. 键值映射
mathjax: true
tags:
  - 算法
category: LeetCode刷题记录
abbrlink: c664
---
# 677. 键值映射

实现一个 MapSum 类，支持两个方法，insert 和 sum：

- MapSum() 初始化 MapSum 对象
- void insert(String key, int val) 插入 key-val 键值对，字符串表示键 key ，整数表示值 val 。如果键 key 已经存在，那么原来的键值对将被替代成新的键值对。
- int sum(string prefix) 返回所有以该前缀 prefix 开头的键 key 的值的总和。

> 链接：https://leetcode-cn.com/problems/map-sum-pairs

<!-- more -->

## 前缀树

看到题目中提到返回所有以前缀prefix开头的键key的值的总和，很容易想到本题需要实现前缀树

但与一般的前缀树不同，本题需要计算以前缀开头的键key的值的总和，可以添加一项sum，在插入过程中直接更新每个节点对应的preifxsum，如果已经存在则需要提前减掉

```java
class MapSum {
    // 实现前缀树
    private static class TrieNode{
        // sum存储当前节点对应的前缀和
        int sum;
        TrieNode[] next;
        boolean end;
        // val存储对应的值
        int val;
        TrieNode(){
            sum = 0;
            next = new TrieNode[26];
            end = false;
            val = 0;
        }
    }

    private final TrieNode root;

    public MapSum() {
        root = new TrieNode();
    }

    public int get(String key){
        // 从Map中检索对应的值是否出现过
        TrieNode curr = root;
        for(char ch:key.toCharArray()){
            int index = ch - 'a';
            // 如果当前值没有出现过，直接返回0
            if(curr.next[index] == null) return 0;
            curr = curr.next[index];
        }
        // 必须是结尾才行
        return curr.val;
    }

    public void insert(String key, int val) {
        // 还需要判断是否已经存在了，已经存在了需要更新sum的值
        // 插入的时候将结果不断累加上去即可
        TrieNode curr = root;
        int prev = get(key);
        val -= prev;
        for(char ch:key.toCharArray()){
            // 逐个插入
            int index = ch - 'a';
            if(curr.next[index] == null){
                curr.next[index] = new TrieNode();
            }
            curr.sum += val;
            curr = curr.next[index];
        }
        curr.sum += val;
        curr.end = true;
        curr.val = val + prev;
    }

    public int sum(String prefix) {
        TrieNode curr = root;
        for(char ch:prefix.toCharArray()){
            int index= ch -'a';
            if(curr.next[index] == null) return 0;
            curr = curr.next[index];
        }
        return curr.sum;
    }
}

/**
 * Your MapSum object will be instantiated and called as such:
 * MapSum obj = new MapSum();
 * obj.insert(key,val);
 * int param_2 = obj.sum(prefix);
 */
```

